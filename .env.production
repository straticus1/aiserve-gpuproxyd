# Server Configuration
# SERVER_HOST options:
#   0.0.0.0 = IPv4 only
#   ::      = IPv6 dual-stack (listens on both IPv4 and IPv6)
#   ::1     = IPv6 localhost only
SERVER_HOST=::
SERVER_PORT=8080
GRPC_PORT=9090
ENVIRONMENT=production

# gRPC TLS Configuration (optional - leave empty for insecure development mode)
# For production, generate certificates with:
#   openssl req -x509 -newkey rsa:4096 -keyout server.key -out server.crt -days 365 -nodes
GRPC_TLS_CERT=
GRPC_TLS_KEY=

# Database Configuration
# Connection details (use PgBouncer host/port if enabled)
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=changeme
DB_NAME=gpuproxy
DB_SSLMODE=disable

# Connection Pool Settings
DB_MAX_CONNS=200                      # Max client connections (can be high with PgBouncer)
DB_MIN_CONNS=20                       # Min idle connections to maintain
DB_MAX_CONN_LIFETIME=15m              # Max connection reuse time (15m for PgBouncer, 1h for direct)
DB_MAX_CONN_IDLE_TIME=5m              # Max idle time before closing (5m for PgBouncer, 30m for direct)
DB_HEALTH_CHECK_PERIOD=1m             # How often to check connection health
DB_CONNECT_TIMEOUT=5s                 # Timeout for new connections

# PgBouncer Configuration
DB_USE_PGBOUNCER=true                 # Whether connecting through PgBouncer (default: true)
DB_PGBOUNCER_POOL_MODE=transaction    # PgBouncer mode: transaction (recommended), session, or statement
                                      # transaction mode = best for high connection count
                                      # session mode = supports prepared statements
                                      # statement mode = most restrictive, highest pooling

# Redis Configuration
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
SESSION_MODE=balanced                 # sql, redis, or balanced

# Redis Connection Pool Settings
REDIS_POOL_SIZE=50                    # Max Redis connections (increase for high load)
REDIS_MIN_IDLE_CONNS=10               # Min idle connections to maintain
REDIS_DIAL_TIMEOUT=5s                 # Timeout for establishing Redis connection
REDIS_READ_TIMEOUT=3s                 # Timeout for Redis read operations
REDIS_WRITE_TIMEOUT=3s                # Timeout for Redis write operations

# Authentication
# ⚠️  SECURITY: Generate with: openssl rand -base64 64
# NEVER use default values in production!
JWT_SECRET=your-jwt-secret-here
JWT_EXPIRATION=24h
REFRESH_EXPIRATION=168h
API_KEY_LENGTH=32

# GPU Providers
# External cloud GPU providers (optional if local GPU backend available)
# ⚠️  SECURITY: NEVER commit real API keys to git!
# Set these via environment variables or secrets manager in production
VASTAI_API_KEY=your-vastai-api-key-here
IONET_API_KEY=your-ionet-api-key-here
GPU_API_TIMEOUT=30s

# GPU Backend Configuration
# Allow server to start without external GPU provider API keys
# Server will auto-detect local GPU backends (CUDA, ROCm, OneAPI)
GPU_ALLOW_START_WITHOUT_PROVIDERS=true

# Preferred local GPU backend: auto (default), cuda, rocm, oneapi
# auto = detect and use first available backend
# Hybrid mode: Local GPU bootstraps, cloud providers handle heavy compute
GPU_PREFERRED_BACKEND=auto

# OCI Object Storage Configuration (replaces AWS S3)
# Used for dataset storage, model artifacts, and training logs
# ⚠️  SECURITY: NEVER commit real OCI credentials to git!
OCI_STORAGE_ENDPOINT=https://objectstorage.us-phoenix-1.oraclecloud.com
OCI_STORAGE_NAMESPACE=your-oci-namespace
OCI_STORAGE_BUCKET=aiserve-storage
OCI_STORAGE_REGION=us-phoenix-1
OCI_ACCESS_KEY_ID=your-oci-access-key-id
OCI_SECRET_ACCESS_KEY=your-oci-secret-access-key

# Billing
STRIPE_SECRET_KEY=sk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...
AFTERDARK_API_URL=https://billing.afterdarksys.com
AFTERDARK_API_KEY=your-afterdark-api-key
CRYPTO_ENABLED=true

# Load Balancing
LB_ENABLED=true
LB_STRATEGY=round_robin

# Guard Rails - Spending Limits (USD)
# Set spending thresholds to control out-of-control spending
# Set to 0 to disable a specific time window limit
GUARDRAILS_ENABLED=false
GUARDRAILS_MAX_5MIN_RATE=0
GUARDRAILS_MAX_15MIN_RATE=0
GUARDRAILS_MAX_30MIN_RATE=0
GUARDRAILS_MAX_60MIN_RATE=0
GUARDRAILS_MAX_90MIN_RATE=0
GUARDRAILS_MAX_120MIN_RATE=0
GUARDRAILS_MAX_240MIN_RATE=0
GUARDRAILS_MAX_300MIN_RATE=0
GUARDRAILS_MAX_360MIN_RATE=0
GUARDRAILS_MAX_400MIN_RATE=0
GUARDRAILS_MAX_460MIN_RATE=0
GUARDRAILS_MAX_520MIN_RATE=0
GUARDRAILS_MAX_640MIN_RATE=0
GUARDRAILS_MAX_700MIN_RATE=0
GUARDRAILS_MAX_1440MIN_RATE=0
GUARDRAILS_MAX_48H_RATE=0
GUARDRAILS_MAX_72H_RATE=0

# Logging Configuration
# Enable syslog logging (default: false)
SYSLOG_ENABLED=false
# Syslog network: tcp, udp, unix, or empty for local syslog
SYSLOG_NETWORK=
# Syslog address: localhost:514, /dev/log, or empty for auto-detect
SYSLOG_ADDRESS=
# Syslog tag for identification
SYSLOG_TAG=aiserve-gpuproxy
# Syslog facility: LOG_LOCAL0 through LOG_LOCAL7
SYSLOG_FACILITY=LOG_LOCAL0
# Log to file instead of syslog (takes precedence over syslog)
LOG_FILE=
# Alternative: Use AISERVE_LOG_FILE environment variable
# AISERVE_LOG_FILE=/var/log/aiserve-gpuproxy.log
